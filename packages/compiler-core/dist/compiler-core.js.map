{
  "version": 3,
  "sources": ["../src/runtimeHelper.ts", "../src/ast.ts", "../src/parser.ts", "../src/transform.ts", "../src/index.ts"],
  "sourcesContent": ["import { NodeTypes } from \"./ast\"\n\nexport const TO_DISPLAY_STRING = Symbol('TO_DISPLAY_STRING')\nexport const CREATE_TEXT_VNODE = Symbol('CREATE_TEXT_VNODE')\nexport const CREATE_ELEMENT_VNODE = Symbol('CREATE_ELEMENT_VNODE')\n\n// \u901A\u8FC7\u540D\u5B57\u505A\u4E00\u4E2A\u6620\u5C04\nexport const helperMap = {\n  [TO_DISPLAY_STRING]: 'toDisplayString',\n  [CREATE_TEXT_VNODE]: 'createTextVNode',\n  [CREATE_ELEMENT_VNODE]: 'createElementVNode',\n}\n\nexport function createCallExpression(context, args) {\n  let name = context.helper(CREATE_TEXT_VNODE)\n  return {\n    type: NodeTypes.JS_CALL_EXPRESSION,\n    arguments: args,\n    callee: name,\n  }\n\n}\n\nexport function createVnodeCall(context, tag, props, children) { \n  context.helper(CREATE_ELEMENT_VNODE)\n\n  return {\n    type: NodeTypes.VNODE_CALL,\n    tag,\n    props,\n    children,\n  }\n}\n", "import { CREATE_TEXT_VNODE } from \"./runtimeHelper\"\n\nexport enum NodeTypes {\n  ROOT,\n  ELEMENT,\n  TEXT,\n  COMMENT,\n  SIMPLE_EXPRESSION, // 1+ 1\n  INTERPOLATION, // {{}}\n  ATTRIBUTE,\n  DIRECTIVE,\n  // containers\n  COMPOUND_EXPRESSION,  // {{ name}} + abc\n  IF,\n  IF_BRANCH,\n  FOR,\n  TEXT_CALL,\n  // codegen\n  VNODE_CALL,\n  JS_CALL_EXPRESSION,\n  JS_OBJECT_EXPRESSION,\n  JS_PROPERTY,\n  JS_ARRAY_EXPRESSION,\n  JS_FUNCTION_EXPRESSION,\n  JS_CONDITIONAL_EXPRESSION,\n  JS_CACHE_EXPRESSION,\n  // ssr codegen\n  JS_BLOCK_STATEMENT,\n  JS_TEMPLATE_LITERAL,\n  JS_IF_STATEMENT,\n  JS_ASSIGNMENT_EXPRESSION,\n  JS_SEQUENCE_EXPRESSION,\n  JS_RETURN_STATEMENT,\n}\n\n\nexport function createCallExpression(context, args) {\n\n  let name = context.helper(CREATE_TEXT_VNODE)\n  return  {\n    type: NodeTypes.JS_CALL_EXPRESSION,\n    arguments: args,\n    callee:name\n  }\n}", "import { NodeTypes } from './ast'\n// \u6A21\u677F\u88C5\u5316\u6210ast\u62BD\u8C61\u8BED\u6CD5\u6811 -> \u5986\u5316\u751F\u6210codegennode -> \u751F\u6210render\u51FD\u6570\n\nfunction createParserContext(content) {\n  return {\n    originalSource: content,\n    source: content,\n    line: 1,\n    column: 1,\n    offset: 0,\n  }\n}\n\nfunction isEnd(context) {\n  const c = context.source\n\n  return !c || c.startsWith('</')\n}\n\nfunction advancePositionMutation(context, c, endIndex) {\n  let linesCount = 0 // \u7B2C\u51E0\u884C\n  let linePos = -1 // \u6362\u884C\u7684\u4F4D\u7F6E\u4FE1\u606F\n\n  for (let i = 0; i < endIndex; i++) {\n    if (c.charCodeAt(i) == 10) {\n      linesCount++\n      linePos = i\n    }\n  }\n\n  context.offset += endIndex\n  context.line += linesCount\n  context.column =\n    linePos == -1 ? context.column + endIndex : endIndex - linePos\n}\nfunction advanceBy(context, endIndex) {\n  let c = context.source\n  // \u9700\u8981\u5728\u8FD9\u91CC\u66F4\u65B0\u4F4D\u7F6E\u4FE1\u606F\n  advancePositionMutation(context, c, endIndex)\n  context.source = c.slice(endIndex)\n}\nfunction getCursor(context) {\n  let { line, column, offset } = context\n  return { line, column, offset }\n}\n\nfunction parseTextData(context, endIndex) {\n  const content = context.source.slice(0, endIndex)\n  advanceBy(context, endIndex)\n  return content\n}\nfunction parseText(context) {\n  let tokens = ['<', '{{'] //\u5F53\u524D\u79BB\u5F97\u6700\u8FD1\u7684\u8BCD\u6CD5\n  let endIndex = context.source.length //\u5047\u8BBE\u6CA1\u6709\u627E\u5230\n\n  for (let i = 0; i < tokens.length; i++) {\n    const index = context.source.indexOf(tokens[i], 1)\n    if (index !== -1 && endIndex > index) {\n      endIndex = index\n    }\n  }\n  let start = getCursor(context)\n  let content = parseTextData(context, endIndex)\n  //0 - endIndex\u4E3A\u6587\u672C\u5185\u5BB9\n  return {\n    type: NodeTypes.TEXT,\n    content,\n    loc: getSelection(context, start),\n  }\n}\n\nfunction parseInterpolation(context) {\n  //{{}}\n  const start = getCursor(context)\n  const openDelimiter = '{{'\n  const closeDelimiter = '}}'\n  advanceBy(context, openDelimiter.length) // \u6D88\u8017 {{\n\n  const closeIndex = context.source.indexOf(closeDelimiter)\n\n  // \u539F\u59CB\u5185\u5BB9\uFF08\u53EF\u80FD\u5305\u542B\u7A7A\u683C\uFF09\n  const preContent = context.source.slice(0, closeIndex)\n\n  advanceBy(context, closeIndex) // \u6D88\u8017\u5185\u5BB9\n\n  const content = preContent.trim() // \u6E05\u7406\u63D2\u503C\u5185\u90E8\u7684\u7A7A\u767D\n\n  advanceBy(context, closeDelimiter.length) // \u6D88\u8017 }}\n\n  return {\n    type: NodeTypes.INTERPOLATION,\n    content: {\n      type: NodeTypes.SIMPLE_EXPRESSION,\n      content,\n    },\n    loc: getSelection(context, start),\n  }\n}\nfunction advanceSpaces(context) {\n  const match = /^[\\t\\r\\n\\f ]+/.exec(context.source)\n  if (match) {\n    //\u5220\u9664\u7A7A\u683C\n    advanceBy(context, match[0].length)\n  }\n}\n// \u83B7\u53D6\u9009\u4E2D\u533A\u57DF\u7684\u51FD\u6570\uFF0C\u7528\u4E8E\u8BB0\u5F55 AST \u8282\u70B9\u7684 loc \u5C5E\u6027\nfunction getSelection(context, start) {\n  // \u5728\u51FD\u6570\u5185\u90E8\u83B7\u53D6\u5F53\u524D\u7684\u7ED3\u675F\u4F4D\u7F6E\n  const end = getCursor(context)\n\n  return {\n    start,\n    end,\n    source: context.originalSource.slice(start.offset, end.offset),\n  }\n}\n\nfunction parseAttributeValue(context) {\n  const quote = context.source[0]\n\n  const isQuoted = quote === '\"' || quote === \"'\"\n\n  let content\n  if (isQuoted) {\n    advanceBy(context, 1) //\u5220\u9664\u5F15\u53F7\n    const endIndex = context.source.indexOf(quote, 1)\n\n    content = parseTextData(context, endIndex)\n    advanceBy(context, 1) //\u5220\u9664\u5F15\u53F7\n  } else {\n    //\u6CA1\u6709\u5F15\u53F7\n    content = context.source.match(/([^ \\t\\r\\n/>])+/)[1]\n\n    advanceBy(context, content.length)\n    advanceSpaces(context)\n  }\n  return content\n}\nfunction parseAttribute(context) {\n  const start = getCursor(context)\n\n  //\u5220\u9664\u4E00\u4E2A\u5C5E\u6027 \"a = '1'\"\u4E2D\u7684 a\n  let match = /^[^\\t\\r\\n\\f />][^\\t\\r\\n\\f />=]*/.exec(context.source)\n\n  const name = match[0]\n\n  advanceBy(context, match[0].length)\n\n  let value\n  //\u5BF9\u4E8E \"a   = '1'\"\u8FD9\u79CD\u60C5\u51B5\n  if (/^[\\t\\r\\n\\f ]*=/.test(context.source)) {\n    advanceSpaces(context)\n    advanceBy(context, 1) //\u5220\u9664 =\n    advanceSpaces(context)\n\n    value = parseAttributeValue(context)\n  }\n\n  let loc = getSelection(context, start)\n  return {\n    type: NodeTypes.ATTRIBUTE,\n    name,\n    value: {\n      type: NodeTypes.TEXT,\n      content: value,\n      loc,\n    },\n    loc: getSelection(context, start),\n  }\n}\nfunction parseAttributes(context) {\n  const props = []\n\n  while (\n    context.source.length > 0 &&\n    !context.source.startsWith('>') &&\n    !context.source.startsWith('/>')\n  ) {\n    props.push(parseAttribute(context))\n    advanceSpaces(context)\n  }\n\n  return props\n}\nfunction parseTag(context) {\n  const start = getCursor(context)\n  //\u5339\u914D <tag \u6216 </tag \u4E2D\u7684\u6807\u7B7E\u540D\n  //0: \"<div\", 1: \"div\"\n  const match = /^<\\/?([a-z][^ \\t\\r\\n/>]*)/.exec(context.source)\n\n  const tag = match[1] //\u83B7\u53D6\u6807\u7B7E\u540D\n\n  advanceBy(context, match[0].length) //\u5220\u9664\u5339\u914D\u7684\u5185\u5BB9\n  //\u5BF9\u4E8E<div   />\u8FD9\u79CD\u60C5\u51B5, \u9700\u8981\u5220\u9664\u591A\u4F59\u7A7A\u683C\n  advanceSpaces(context)\n\n  let props = parseAttributes(context)\n  const isSelfClosing = context.source.startsWith('/>')\n\n  advanceBy(context, isSelfClosing ? 2 : 1) //\u5220\u9664 /> \u6216 >\n  return {\n    type: NodeTypes.ELEMENT,\n    tag,\n    isSelfClosing,\n    loc: getSelection(context, start), //\u5F00\u5934\u6807\u7B7E\u89E3\u6790\u540E\u7684\u4FE1\u606F\n    props,\n    children: [],\n  }\n}\n\nfunction parseElement(context) {\n  const ele = parseTag(context)\n\n  //\u5982\u679C\u4E0D\u662F\u81EA\u95ED\u5408\u6807\u7B7E, \u9012\u5F52\u89E3\u6790\u5B50\u8282\u70B9\n  if (!ele.isSelfClosing) {\n    ele.children = parseChildren(context)\n\n    if (context.source.startsWith('</')) {\n      const endTag = parseTag(context)\n\n      // \u9A8C\u8BC1\u6807\u7B7E\u5339\u914D\n      if (endTag.tag !== ele.tag) {\n        // \u5B9E\u9645\u9879\u76EE\u4E2D\u8FD9\u91CC\u4F1A\u629B\u51FA\u8BED\u6CD5\u9519\u8BEF\n        console.error(`\u6807\u7B7E\u4E0D\u5339\u914D: \u671F\u671B </${ele.tag}>\uFF0C\u4F46\u5F97\u5230 </${endTag.tag}>`)\n      }\n    }\n  } else {\n    // \u81EA\u95ED\u5408\u6807\u7B7E\u6CA1\u6709\u5B50\u8282\u70B9\n    ele.children = []\n  }\n\n  // 4. \u8BB0\u5F55\u6574\u4E2A\u5143\u7D20\u8282\u70B9\u7684\u5B8C\u6574\u4F4D\u7F6E\u4FE1\u606F\n  // \u6CE8\u610F\uFF1Aele.loc.start \u662F\u5728 parseTag \u4E2D\u8BB0\u5F55\u7684\u5F00\u59CB\u4F4D\u7F6E\n  ele.loc = getSelection(context, ele.loc.start)\n  return ele\n}\nfunction parseChildren(context) {\n  const nodes = [] as any\n  while (!isEnd(context)) {\n    const c = context.source //\u73B0\u5728\u89E3\u6790\u7684\u5185\u5BB9\n\n    let node\n    if (c.startsWith('{{')) {\n      node = parseInterpolation(context)\n    } else if (c[0] === '<') {\n      node = parseElement(context)\n    } else {\n      //\u6587\u672C\n      node = parseText(context)\n    }\n    nodes.push(node)\n  }\n\n  for (let i = 0; i < nodes.length; i++) {\n    let node = nodes[i]\n\n    if (node.type === NodeTypes.TEXT) {\n      //\u5BF9\u7A7A\u767D\u5B57\u7B26\u505A\u5904\u7406\n      if (!/[^\\t\\r\\n\\f ]/.test(node.content)) {\n        nodes[i] = null\n      } else {\n        node.content = node.content.replace(/[\\t\\r\\n\\f ]+/g, ' ')\n      }\n    }\n  }\n  //\u6E05\u7A7A\u7A7A\u767D\u8282\u70B9\n  return nodes.filter(Boolean)\n}\n\nfunction createRoot(children) {\n  return {\n    type: NodeTypes.ROOT,\n    children,\n  }\n}\nexport function parse(template) {\n  // \u521B\u5EFA\u89E3\u6790\u4E0A\u4E0B\u6587\n  const context = createParserContext(template)\n\n  return createRoot(parseChildren(context))\n}\n", "import { parse } from './parser'\nimport { createCallExpression, NodeTypes } from './ast'\nimport { TO_DISPLAY_STRING } from './runtimeHelper'\nimport { createVnodeCall } from './runtimeHelper'\n\n\n// dom\u7684\u904D\u5386\u65B9\u5F0F, \u5148\u5E8F, \u540E\u7EED\n// \u5143\u7D20 -> \u6587\u672C -> \u6587\u672C\u5904\u7406\u540E -> \u5143\u7D20\u5904\u7406\u540E -> \u6839\u5904\u7406\u540E\n// index.ts - transformElement \u51FD\u6570\n\nfunction transformElement(node, context) {\n    if (NodeTypes.ELEMENT === node.type) {\n        \n        // \u3010\u524D\u5E8F\u5904\u7406\u3011\uFF1A\u5904\u7406 v-if/v-for \u6307\u4EE4\uFF0C\u4F46\u6B64\u5904\u7B80\u5316\u4E3A\u53EA\u8FD4\u56DE\u540E\u5E8F\u51FD\u6570\n        \n        return function () {\n            // \u3010\u540E\u5E8F\u5904\u7406\u3011\uFF1A\u5728\u5B50\u8282\u70B9\u90FD\u5904\u7406\u5B8C\u6BD5\u540E\u6267\u884C\n\n            // 1. \u9ED8\u8BA4\u8BBE\u7F6E\uFF1Atag \u4E3A\u5B57\u7B26\u4E32\uFF0Cprops \u4E3A null\uFF0Cchildren \u4E3A null\n            const tag = JSON.stringify(node.tag)\n            let props = null \n            let children = node.children\n\n            // 2. \u68C0\u67E5\u5B50\u8282\u70B9\u6570\u91CF\uFF0C\u5982\u679C\u53EA\u6709\u4E00\u4E2A\uFF0C\u76F4\u63A5\u53D6\u7B2C\u4E00\u4E2A\n            if (children.length === 1) {\n                children = children[0]\n            } else if (children.length === 0) {\n                children = null\n            } \n            // \u5982\u679C\u591A\u4E8E\u4E00\u4E2A\uFF0Cchildren \u4FDD\u6301\u4E3A\u6570\u7EC4 [child1, child2, ...]\n\n            // 3. \u521B\u5EFA VNODE_CALL (Code Generation Node)\n            const vnodeCall = createVnodeCall(context, tag, props, children)\n            \n            // 4. \u5C06 ELEMENT \u8282\u70B9\u66FF\u6362\u4E3A VNODE_CALL (\u901A\u8FC7 Object.assign \u66FF\u6362\u5C5E\u6027)\n            // \u8FD9\u6837\u505A\u53EF\u4EE5\u8BA9\u7236\u8282\u70B9 children \u6570\u7EC4\u4E2D\u7684\u5F15\u7528\u6307\u5411\u65B0\u7684 VNODE_CALL\n            Object.assign(node, vnodeCall)\n            node.type = NodeTypes.VNODE_CALL\n            \n            // 5. \u5C06 VNODE_CALL \u6302\u8F7D\u5230\u6839\u8282\u70B9\u7684 codegenNode \u4E0A (\u5982\u679C\u662F\u6839\u8282\u70B9)\n            if (context.parent.type === NodeTypes.ROOT) {\n                context.parent.codegenNode = vnodeCall\n            }\n        }\n    }\n}\n\nfunction isText(node) {\n\treturn NodeTypes.TEXT === node.type || NodeTypes.INTERPOLATION === node.type\n}\nfunction transformText(node, context) {\n\tif (NodeTypes.ELEMENT === node.type || NodeTypes.ROOT === node.type) {\n\t\t//\u6CE8\u610F\u5904\u7406\u987A\u5E8F, \u8981\u7B49\u5F85\u5B50\u8282\u70B9\u5168\u90E8\u5904\u7406\u540E, \u518D\u8D4B\u503C\u7ED9\u7236\u5143\u7D20\n\t\treturn function () {\n      const children = node.children\n      let container = null // \u7528\u4E8E\u4FDD\u5B58\u5408\u5E76\u540E\u7684 COMPOUND_EXPRESSION\n      \n      // \u4ECE\u540E\u5F80\u524D\u904D\u5386\uFF0C\u56E0\u4E3A\u5408\u5E76\u64CD\u4F5C\u4F1A\u6539\u53D8\u6570\u7EC4\u957F\u5EA6\n      for (let i = children.length - 1; i >= 0; i--) {\n          const child = children[i]\n  \n          // \u68C0\u67E5\u5F53\u524D\u8282\u70B9\u662F\u5426\u662F TEXT \u6216 INTERPOLATION\n          if (isText(child)) {\n              // \u4ECE\u5F53\u524D\u8282\u70B9\u5F80\u524D\u627E\u76F8\u90BB\u7684\u6587\u672C/\u63D2\u503C\n              for (let j = i - 1; j >= 0; j--) {\n                  const prev = children[j]\n  \n                  if (isText(prev)) {\n                      // \u5982\u679C\u76F8\u90BB\u7684\u4E5F\u662F\u6587\u672C/\u63D2\u503C\uFF0C\u5219\u8FDB\u884C\u5408\u5E76\n                      if (!container) {\n                          // \u7B2C\u4E00\u6B21\u5408\u5E76\uFF1A\u521B\u5EFA COMPOUND_EXPRESSION \u5BB9\u5668\n                          container = children[i] = {\n                              type: NodeTypes.COMPOUND_EXPRESSION,\n                              children: [child] // \u5F53\u524D\u8282\u70B9\u4F5C\u4E3A\u5BB9\u5668\u7684\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9\n                          }\n                      }\n  \n                      // 1. \u5C06\u524D\u4E00\u4E2A\u8282\u70B9\u6DFB\u52A0\u5230\u5BB9\u5668\u5934\u90E8\n                      container.children.unshift(prev)\n                      \n                      // 2. \u5C06\u524D\u4E00\u4E2A\u8282\u70B9\u4ECE\u7236\u8282\u70B9\u7684 children \u6570\u7EC4\u4E2D\u79FB\u9664\n                      children.splice(j, 1)\n  \n                      // 3. \u66F4\u65B0\u5916\u5C42\u5FAA\u73AF\u7684\u7D22\u5F15 i\uFF0C\u56E0\u4E3A\u6570\u7EC4\u957F\u5EA6\u548C\u4F4D\u7F6E\u90FD\u53D8\u4E86\n                      i--\n                  } else {\n                      // \u9047\u5230\u975E\u6587\u672C\u8282\u70B9\uFF08\u5982 Element\uFF09\uFF0C\u505C\u6B62\u5411\u524D\u5408\u5E76\n                      container = null\n                      break\n                  }\n              }\n          }\n      }\n  \n      // \u6700\u7EC8\uFF1A\u5982\u679C\u7236\u8282\u70B9\u7684 children \u6570\u7EC4\u53EA\u5269\u4E00\u4E2A COMPOUND_EXPRESSION\uFF0C\n      // \u5C06\u5176\u5305\u88C5\u6210\u4E00\u4E2A CREATE_TEXT_VNODE \u8C03\u7528\uFF08\u4F8B\u5982\uFF1A_createTextVNode(\"hello\" + _toDisplayString(name))\uFF09\n      if (children.length === 1 && children[0].type === NodeTypes.COMPOUND_EXPRESSION) {\n          // \u521B\u5EFA TEXT_CALL \u8282\u70B9\uFF0C\u5B83\u4F1A\u88AB CodeGen \u7FFB\u8BD1\u6210 createTextVNode\n          children[0] = {\n              type: NodeTypes.TEXT_CALL,\n              codegenNode: createCallExpression(context, children[0].children) \n              // createCallExpression \u5185\u90E8\u4F1A\u8C03\u7528 context.helper(CREATE_TEXT_VNODE)\n          }\n      }\n  }\n\t}\n}\nfunction transformExpression(node, context) {\n\tif (NodeTypes.INTERPOLATION === node.type) {\n\t\tnode.content.content = '_ctx.' + node.content.content\n\t}\n}\n\nfunction traverseNode(node, context) {\n  context.currentNode = node\n  const transforms = context.transformNode\n\n  const exits = [] //\u5143\u7D20\u51FD\u6570, \u6587\u672C\u51FD\u6570, \u8868\u8FBE\u5F0F\u51FD\u6570\n  for (let i = 0; i < transforms.length; i++) {\n    let exit = transforms[i](node, context)\n    exit && exits.push(exit)\n  }\n\n  switch (node.type) {\n    case NodeTypes.ROOT:\n      break\n    case NodeTypes.ELEMENT:\n      for (let i = 0; i < node.children.length; i++) {\n        context.parent = node\n        traverseNode(node.children[i], context)\n      }\n      break\n    //\u5BF9\u8868\u8FBE\u5F0F\u7684\u5904\u7406\n    case NodeTypes.INTERPOLATION:\n      context.helper(TO_DISPLAY_STRING)\n      break\n  }\n\n  let i = exits.length\n  if (exits.length) {\n    while (i--) {\n      exits[i]()\n    }\n  }\n}\n\nfunction createTransformContext(root) {\n\tconst context = {\n\t\tcurrentNode: root,\n\t\tparent: null,\n\t\t//createElementVnode createTextVnode createCommentVnode\n\t\ttransformNode: [transformElement, transformText, transformExpression],\n\n\t\thelpers: new Map(),\n\t\thelper(name) {\n\t\t\tlet count = context.helpers.get(name) || 0\n\t\t\tcontext.helpers.set(name, count + 1)\n\t\t\treturn name\n\t\t},\n\t}\n\treturn context\n}\n\n\nexport function transform(ast) {\n\t//\u5BF9ast\u8FDB\u884C\u8F6C\u6362\n\tconst context = createTransformContext(ast)\n\n\ttraverseNode(ast, context)\n\n\tast.helpers = [...context.helpers.keys()]\n}\n\n\n\n", "import { parse } from './parser'\nimport {\n\tCREATE_ELEMENT_VNODE,\n\tTO_DISPLAY_STRING,\n\tCREATE_TEXT_VNODE,\n\thelperMap,\n} from './runtimeHelper'\nimport { transform } from './transform'\nimport { NodeTypes } from './ast'\n\nexport function compile(template) {\n\tconst ast = parse(template)\n\ttransform(ast)\n\treturn generate(ast)\n}\n\nfunction createCodegenContext() {\n\tconst context = {\n\t\tcode: ``,\n\t\tlevel: 0,\n\t\thelper(name) {\n\t\t\treturn '_' + helperMap[name]\n\t\t},\n\t\tpush(code) {\n\t\t\tcontext.code += code\n\t\t},\n\t\tindent() {\n\t\t\tnewLine(++context.level)\n\t\t},\n\t\tdeindent(noNewLine = false) {\n\t\t\tnewLine(--context.level)\n\t\t},\n\t}\n\tfunction newLine(n) {\n\t\tcontext.push('\\n' + `  `.repeat(n))\n\t}\n\n\treturn context\n}\n// \u9012\u5F52\u751F\u6210 AST \u8282\u70B9\u7684\u4EE3\u7801\nfunction genNode(node, context) {\n\tconst { push } = context\n\tswitch (node.type) {\n\t\tcase NodeTypes.VNODE_CALL:\n\t\t\t// \u751F\u6210 createElementVNode(...)\n\t\t\tgenVNodeCall(node, context)\n\t\t\tbreak\n\t\tcase NodeTypes.TEXT:\n\t\t\tpush(JSON.stringify(node.content)) // 'Hello'\n\t\t\tbreak\n\t\tcase NodeTypes.INTERPOLATION:\n\t\tcase NodeTypes.SIMPLE_EXPRESSION:\n\t\t\t// \u751F\u6210 _ctx.name \u6216 toDisplayString(_ctx.name)\n\t\t\tgenCallExpression(node.content, context)\n\t\t\tbreak\n\t\tcase NodeTypes.JS_CALL_EXPRESSION:\n\t\t\tgenCallExpression(node, context)\n\t\t\tbreak\n\t\t// ... \u5176\u4ED6\u8282\u70B9\u7C7B\u578B\n\t}\n}\n\n// \u8865\u5145\uFF1A\u751F\u6210 VNODE_CALL \u7684\u903B\u8F91\nfunction genVNodeCall(node, context) {\n\tconst { push, helper } = context\n\t// \u5047\u8BBE tag, props, children \u5DF2\u7ECF\u5C31\u4F4D\n\tpush(\n\t\t`${helper(CREATE_ELEMENT_VNODE)}(${node.tag}, ${node.props}, ${\n\t\t\tnode.children\n\t\t})`\n\t)\n}\n\n// \u8865\u5145\uFF1A\u751F\u6210 CallExpression \u7684\u903B\u8F91 (\u4F8B\u5982 toDisplayString(_ctx.name))\nfunction genCallExpression(node, context) {\n\tconst { push, helper } = context\n\tpush(`${helper[node.callee]}(`)\n\tgenNode(node.arguments[0], context) // \u7B80\u5316\uFF1A\u53EA\u5904\u7406\u7B2C\u4E00\u4E2A\u53C2\u6570\n\tpush(`)`)\n}\n\nexport function generate(ast) {\n\tconst context = createCodegenContext()\n\tconst { push, indent, deindent } = context\n\n\t// 1. \u5BFC\u5165\u8F85\u52A9\u51FD\u6570\uFF08\u5047\u8BBE\u4ECE\u5168\u5C40 Vue \u5BF9\u8C61\u83B7\u53D6\uFF09\n\tconst helpers = [...ast.helpers.keys()]\n\tpush(`const { ${\n        helpers.map(s => helperMap[s]).map(n => `_${n}: ${n}`).join(', ')\n    } } = Vue`) \n    // \u4F8B\u5982\uFF1Aconst { _toDisplayString: toDisplayString } = Vue\n\n\t// 2. \u62FC\u63A5 render \u51FD\u6570\u7B7E\u540D\n\tpush(`\\nreturn function render(_ctx, _cache) {`)\n\tindent()\n\t\n\t// 3. \u9012\u5F52\u751F\u6210 AST \u7684\u4EE3\u7801\n\tpush(`return `)\n\tgenNode(ast.codegenNode, context) // ast.codegenNode \u662F\u6700\u7EC8\u8981\u6E32\u67D3\u7684 VNODE_CALL\n\t\n\tdeindent()\n\tpush(`\\n}`)\n\n\treturn context.code\n}"],
  "mappings": "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",
  "names": ["i"]
}
