<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="app"></div>

  <style>
    .v-enter-active,
    .v-leave-active {
      transition: opacity 2s ease;
    }
    .v-enter-from, /* 动画起点 */
    .v-leave-to { /* 离开终点 */
      opacity: 0; /* 或 0 */
    }

  </style>
  <script type="module">
    // import { 
    //   render, 
    //   ref,
    //    h, 
    //   Text, 
    //   Fragment,
    //   provide,
    //   inject,
    //   Teleport,
    //   onMounted,
    //   defineAsyncComponent,
    // } from 
    // "/node_modules/@vue/runtime-dom/dist/runtime-dom.esm-browser.js"
    
    import { 
     ref,
     render,
     h, 
     Text, 
     Fragment,
     provide,
    inject,
    Teleport,
    onMounted,
    Transition,
    defineAsyncComponent,
    } from './runtime-dom.js'


  let attempts = 0
  const MyComponent = defineAsyncComponent({
  loader: () => {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        if(attempts++ < 2) {
          reject({
            setup() {
              // 添加setup函数确保组件正确初始化
              return () => h('div', 'first')
            }
          })
        } else {
          resolve({
            setup() {
              // 添加setup函数确保组件正确初始化
              return () => h('div', 'second')
            }
          })
        }
      }, 3000)
    })
  },
  timeout: 1000,
  errorComponent: {
    setup() {
      return () => h('div', 'Error')
    }
  },

  delay: 500,
  loadingComponent: {
    setup() {
      return () => h('div', 'loading~')
    }
  },

  onError(err, retry, fail, attempts) {
    console.log(attempts)
    setTimeout(() => {
      retry()
      console.log('loading~')
    }, 1000)
  }
})

// 确保DOM元素存在
const app = document.querySelector('#app')
if (app) {
  render(h(MyComponent), app)
}
  </script>
</body>
</html>
