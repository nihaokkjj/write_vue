{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { NodeTypes } from './ast'\n// \u6A21\u677F\u88C5\u5316\u6210ast\u62BD\u8C61\u8BED\u6CD5\u6811 -> \u5986\u5316\u751F\u6210codegennode -> \u751F\u6210render\u51FD\u6570\n\nfunction createParserContext(content) {\n\treturn {\n\t\toriginalSource: content,\n\t\tsource: content,\n\t\tline: 1,\n\t\tcolumn: 1,\n\t\toffset: 0,\n\t}\n}\n\nfunction isEnd(context) {\n\tconst c = context.source\n\n\treturn !c || c.startsWith('</')\n}\n\nfunction advancePositionMutation(context, c, endIndex) {\n\tlet linesCount = 0 // \u7B2C\u51E0\u884C\n\tlet linePos = -1 // \u6362\u884C\u7684\u4F4D\u7F6E\u4FE1\u606F\n\n\tfor (let i = 0; i < endIndex; i++) {\n\t\tif (c.charCodeAt(i) == 10) {\n\t\t\tlinesCount++\n\t\t\tlinePos = i\n\t\t}\n\t}\n\n\tcontext.offset += endIndex\n\tcontext.line += linesCount\n\tcontext.column =\n\t\tlinePos == -1 ? context.column + endIndex : endIndex - linePos\n}\nfunction advanceBy(context, endIndex) {\n\tlet c = context.source\n\t// \u9700\u8981\u5728\u8FD9\u91CC\u66F4\u65B0\u4F4D\u7F6E\u4FE1\u606F\n\tadvancePositionMutation(context, c, endIndex)\n\tcontext.source = c.slice(endIndex)\n}\nfunction getCursor(context) {\n\tlet { line, column, offset } = context\n\treturn { line, column, offset }\n}\n\nfunction parseTextData(context, endIndex) {\n\tconst content = context.source.slice(0, endIndex)\n\tadvanceBy(context, endIndex)\n\treturn content\n}\nfunction parseText(context) {\n\tlet tokens = ['<', '{{'] //\u5F53\u524D\u79BB\u5F97\u6700\u8FD1\u7684\u8BCD\u6CD5\n\tlet endIndex = context.source.length //\u5047\u8BBE\u6CA1\u6709\u627E\u5230\n\n\tfor (let i = 0; i < tokens.length; i++) {\n\t\tconst index = context.source.indexOf(tokens[i], 1)\n\t\tif (index !== -1 && endIndex > index) {\n\t\t\tendIndex = index\n\t\t}\n\t}\n\tlet start = getCursor(context)\n\tlet content = parseTextData(context, endIndex)\n\t//0 - endIndex\u4E3A\u6587\u672C\u5185\u5BB9\n\treturn {\n\t\ttype: NodeTypes.TEXT,\n\t\tcontent,\n\t\tloc: getSelection(context, start),\n\t}\n}\n\nfunction parseInterpolation(context) {\n\t//{{}}\n\tconst start = getCursor(context)\n\tconst openDelimiter = '{{'\n\tconst closeDelimiter = '}}'\n\tadvanceBy(context, openDelimiter.length) // \u6D88\u8017 {{\n\n\tconst closeIndex = context.source.indexOf(closeDelimiter)\n\n\t// \u539F\u59CB\u5185\u5BB9\uFF08\u53EF\u80FD\u5305\u542B\u7A7A\u683C\uFF09\n\tconst preContent = context.source.slice(0, closeIndex)\n\n\tadvanceBy(context, closeIndex) // \u6D88\u8017\u5185\u5BB9\n\n\tconst content = preContent.trim() // \u6E05\u7406\u63D2\u503C\u5185\u90E8\u7684\u7A7A\u767D\n\n\tadvanceBy(context, closeDelimiter.length) // \u6D88\u8017 }}\n\n\treturn {\n\t\ttype: NodeTypes.INTERPOLATION,\n\t\tcontent: {\n\t\t\ttype: NodeTypes.SIMPLE_EXPRESSION,\n\t\t\tcontent,\n\t\t},\n\t\tloc: getSelection(context, start),\n\t}\n}\nfunction advanceSpaces(context) {\n\tconst match = /^[\\t\\r\\n\\f ]+/.exec(context.source)\n\tif (match) {\n\t\t//\u5220\u9664\u7A7A\u683C\n\t\tadvanceBy(context, match[0].length)\n\t}\n}\n// \u83B7\u53D6\u9009\u4E2D\u533A\u57DF\u7684\u51FD\u6570\uFF0C\u7528\u4E8E\u8BB0\u5F55 AST \u8282\u70B9\u7684 loc \u5C5E\u6027\nfunction getSelection(context, start) {\n\t// \u5728\u51FD\u6570\u5185\u90E8\u83B7\u53D6\u5F53\u524D\u7684\u7ED3\u675F\u4F4D\u7F6E\n\tconst end = getCursor(context)\n\n\treturn {\n\t\tstart,\n\t\tend,\n\t\tsource: context.originalSource.slice(start.offset, end.offset),\n\t}\n}\n\nfunction parseAttribute(context) {\n\n  const start = getCursor(context)\n\n  //\u5220\u9664\u4E00\u4E2A\u5C5E\u6027 a = \"1\"\n  let match = /^[^\\t\\r\\n\\f />][^\\t\\r\\n\\f />=]*/.exec(context.source)\n\n  const name = match[0]\n  advanceBy(context, match[0].length)\n\treturn {\n\t\ttype: NodeTypes.ATTRIBUTE,\n\t\tname,\n\t\tvalue: {\n\t\t\ttype: NodeTypes.TEXT,\n\t\t\tcontent: '?',\n\t\t\tloc: '?',\n\t\t},\n    loc: getSelection(context, start),\n\t}\n}\nfunction parseAttributes(context) {\n\tconst props = []\n\n\twhile (\n\t\tcontext.source.length > 0 &&\n\t\t!context.source.startsWith('>') &&\n\t\t!context.source.startsWith('/>')\n\t) {\n\t\tprops.push(parseAttribute(context))\n\t\tadvanceSpaces(context)\n\t}\n\n\treturn props\n}\nfunction parseTag(context) {\n\tconst start = getCursor(context)\n\t//\u5339\u914D <tag \u6216 </tag \u4E2D\u7684\u6807\u7B7E\u540D\n\t//0: \"<div\", 1: \"div\"\n\tconst match = /^<\\/?([a-z][^ \\t\\r\\n/>]*)/.exec(context.source)\n\n\tconst tag = match[1] //\u83B7\u53D6\u6807\u7B7E\u540D\n\n\tadvanceBy(context, match[0].length) //\u5220\u9664\u5339\u914D\u7684\u5185\u5BB9\n\t//\u5BF9\u4E8E<div   />\u8FD9\u79CD\u60C5\u51B5, \u9700\u8981\u5220\u9664\u591A\u4F59\u7A7A\u683C\n\tadvanceSpaces(context)\n\n\tlet props = parseAttributes(context)\n\tconst isSelfClosing = context.source.startsWith('/>')\n\n\tadvanceBy(context, isSelfClosing ? 2 : 1) //\u5220\u9664 /> \u6216 >\n\treturn {\n\t\ttype: NodeTypes.ELEMENT,\n\t\ttag,\n\t\tisSelfClosing,\n\t\tloc: getSelection(context, start), //\u5F00\u5934\u6807\u7B7E\u89E3\u6790\u540E\u7684\u4FE1\u606F\n\t\tprops,\n\t}\n}\n\nfunction parseElement(context) {\n\tconst ele = parseTag(context)\n\n\t//\u5982\u679C\u4E0D\u662F\u81EA\u95ED\u5408\u6807\u7B7E, \u9012\u5F52\u89E3\u6790\u5B50\u8282\u70B9\n\tif (!ele.isSelfClosing) {\n\t\tconst children = parseChildren(context)\n\n\t\tif (context.source.startsWith('</')) {\n\t\t\tconst endTag = parseTag(context)\n\n\t\t\t// \u9A8C\u8BC1\u6807\u7B7E\u5339\u914D\n\t\t\tif (endTag.tag !== ele.tag) {\n\t\t\t\t// \u5B9E\u9645\u9879\u76EE\u4E2D\u8FD9\u91CC\u4F1A\u629B\u51FA\u8BED\u6CD5\u9519\u8BEF\n\t\t\t\tconsole.error(`\u6807\u7B7E\u4E0D\u5339\u914D: \u671F\u671B </${ele.tag}>\uFF0C\u4F46\u5F97\u5230 </${endTag.tag}>`)\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// \u81EA\u95ED\u5408\u6807\u7B7E\u6CA1\u6709\u5B50\u8282\u70B9\n\t\tele.children = []\n\t}\n\n\t// 4. \u8BB0\u5F55\u6574\u4E2A\u5143\u7D20\u8282\u70B9\u7684\u5B8C\u6574\u4F4D\u7F6E\u4FE1\u606F\n\t// \u6CE8\u610F\uFF1Aele.loc.start \u662F\u5728 parseTag \u4E2D\u8BB0\u5F55\u7684\u5F00\u59CB\u4F4D\u7F6E\n\tele.loc = getSelection(context, ele.loc.start)\n\treturn ele\n}\nfunction parseChildren(context) {\n\tconst nodes = [] as any\n\twhile (!isEnd(context)) {\n\t\tconst c = context.source //\u73B0\u5728\u89E3\u6790\u7684\u5185\u5BB9\n\n\t\tlet node\n\t\tif (c.startsWith('{{')) {\n\t\t\tnode = parseInterpolation(context)\n\t\t} else if (c[0] === '<') {\n\t\t\tnode = parseElement(context)\n\t\t} else {\n\t\t\t//\u6587\u672C\n\t\t\tnode = parseText(context)\n\t\t}\n\t\tnodes.push(node)\n\t}\n\treturn nodes\n}\n\nfunction createRoot(children) {\n\treturn {\n\t\ttype: NodeTypes.ROOT,\n\t\tchildren,\n\t}\n}\nexport function parse(template) {\n\t// \u521B\u5EFA\u89E3\u6790\u4E0A\u4E0B\u6587\n\tconst context = createParserContext(template)\n\n\treturn createRoot(parseChildren(context))\n}\n"],
  "mappings": "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",
  "names": []
}
